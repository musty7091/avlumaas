{% extends 'core/base.html' %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h3 class="fw-bold text-dark m-0">ğŸ“‹ GiriÅŸ - Ã‡Ä±kÄ±ÅŸ Hareketleri</h3>
    
    <div class="d-flex gap-2 no-print">
        <button onclick="window.print()" class="btn btn-dark fw-bold shadow-sm">
            ğŸ–¨ï¸ YazdÄ±r
        </button>

        <a href="{% url 'giris_cikis_raporu_indir' %}?ay={{ ay }}&yil={{ yil }}&personel_id={{ secilen_personel_id|default:'' }}" class="btn btn-success fw-bold shadow-sm">
            ğŸ“Š Excel Ä°ndir
        </a>
    </div>
</div>

<form method="GET" class="card p-3 mb-4 bg-light shadow-sm border-0 no-print">
    <div class="row g-2 align-items-center">
        <div class="col-auto"><label class="fw-bold">DÃ¶nem:</label></div>
        <div class="col-auto">
            <input type="number" name="ay" class="form-control" value="{{ ay }}" min="1" max="12" style="width: 70px;">
        </div>
        <div class="col-auto">
            <input type="number" name="yil" class="form-control" value="{{ yil }}" style="width: 100px;">
        </div>

        <div class="col-auto ms-3"><label class="fw-bold">Personel:</label></div>
        <div class="col-auto">
            <select name="personel_id" class="form-select" style="min-width: 200px;">
                <option value="">-- TÃ¼m Personeller --</option>
                {% for p in personeller %}
                    <option value="{{ p.id }}" {% if p.id == secilen_personel_id %}selected{% endif %}>
                        {{ p.ad }} {{ p.soyad }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <div class="col-auto ms-2">
            <button type="submit" class="btn btn-primary">Listele</button>
        </div>
    </div>
</form>

<div class="card shadow-sm border-0 print-border-0">
    <div class="d-none d-print-block mb-3">
        <h4>GiriÅŸ Ã‡Ä±kÄ±ÅŸ Raporu</h4>
        <small>DÃ¶nem: {{ ay }}/{{ yil }}</small>
    </div>

    <div class="table-responsive">
        <table class="table table-hover align-middle mb-0 text-center table-striped-print">
            <thead class="table-dark text-white">
                <tr>
                    <th class="text-start ps-3">Tarih</th>
                    <th class="text-start">Personel</th>
                    <th>Durum</th>
                    <th>GiriÅŸ</th>
                    <th>Ã‡Ä±kÄ±ÅŸ</th>
                    <th>Mesai</th>
                </tr>
            </thead>
            <tbody>
                {% for k in kayitlar %}
                <tr>
                    <td class="text-start ps-3 fw-bold bg-light text-nowrap">
                        {{ k.tarih|date:"d M Y" }} 
                        <span class="text-muted fw-normal small ms-1">- {{ k.tarih|date:"l" }}</span>
                    </td>
                    
                    <td class="text-start fw-bold text-primary">
                        {{ k.personel.ad }} {{ k.personel.soyad }}
                    </td>
                    <td>
                        {% if k.durum == 'geldi' %}
                            <span class="badge bg-success bg-opacity-10 text-success border border-success">Geldi</span>
                        {% elif k.durum == 'gelmedi' %}
                            <span class="badge bg-danger bg-opacity-10 text-danger border border-danger">Gelmedi</span>
                        {% elif k.durum == 'hafta_tatili' %}
                            <span class="badge bg-warning bg-opacity-10 text-dark border border-warning">Hafta Tatili</span>
                        {% else %}
                            <span class="badge bg-secondary">{{ k.get_durum_display }}</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if k.giris_saati %}
                            <span class="fw-bold fs-5">{{ k.giris_saati|date:"H:i" }}</span>
                        {% else %}
                            <span class="text-muted">-</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if k.cikis_saati %}
                            <span class="fw-bold fs-5">{{ k.cikis_saati|date:"H:i" }}</span>
                        {% else %}
                            <span class="text-muted">-</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if k.hesaplanan_mesai_saati > 0 %}
                            <span class="badge bg-success">+{{ k.hesaplanan_mesai_saati }} Saat</span>
                        {% elif k.hesaplanan_mesai_saati < 0 %}
                            <span class="badge bg-danger">{{ k.hesaplanan_mesai_saati }} Saat</span>
                        {% else %}
                            <span class="text-muted">-</span>
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6" class="text-center py-5 text-muted">
                        {% if secilen_personel_id %}
                            SeÃ§ilen personel iÃ§in bu ayda kayÄ±t bulunamadÄ±.
                        {% else %}
                            Bu ay iÃ§in henÃ¼z bir giriÅŸ kaydÄ± yok.
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<div style="height: 50px;"></div>

<style>
    @media print {
        /* Gizlenecek Elemanlar */
        .no-print, .navbar, .mobile-bottom-nav, form, .btn {
            display: none !important;
        }

        /* Sayfa YapÄ±sÄ± */
        body { background-color: white; }
        .container { max-width: 100% !important; width: 100% !important; padding: 0 !important; margin: 0 !important; }
        .card { box-shadow: none !important; border: none !important; }
        
        /* Tablo AyarlarÄ± */
        .table-responsive { overflow: visible !important; }
        table { width: 100% !important; font-size: 12px; }
        thead th { background-color: #333 !important; color: white !important; -webkit-print-color-adjust: exact; }
        
        /* Rozetlerin (Badge) Renkli Ã‡Ä±kmasÄ± Ä°Ã§in */
        .badge { border: 1px solid #000; color: black !important; background: none !important; }
        
        /* Sayfa BaÅŸlÄ±ÄŸÄ± GÃ¶rÃ¼nsÃ¼n */
        .d-print-block { display: block !important; }
    }
</style>
{% endblock %}