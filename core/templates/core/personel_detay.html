{% extends 'core/base.html' %}

{% block content %}
<div class="card mb-3 shadow-sm">
    <div class="card-body">
        <h3 class="text-primary">{{ personel.ad }} {{ personel.soyad }}</h3>
        <p class="mb-1"><strong>Telefon:</strong> {{ personel.telefon }}</p>
        <p class="mb-0"><strong>MaaÅŸ Tipi:</strong> {{ personel.get_calisma_tipi_display }} ({{ personel.maas_tutari }} TL)</p>
        
        <a href="{% url 'toplu_puantaj' personel.id %}" class="btn btn-primary w-100 mt-3 fw-bold">
            ðŸ“… AylÄ±k Toplu GiriÅŸ (Takvim)
        </a>
    </div>
</div>

<h5 class="mt-4 ms-1">HÄ±zlÄ± Ä°ÅŸlem Ekle (Avans / Prim)</h5>
<form method="POST" class="card p-3 bg-light mb-4 shadow-sm border-0">
    {% csrf_token %}
    <input type="hidden" name="basit_islem" value="1">
    
    <div class="mb-2">
        <label class="form-label small fw-bold">Ä°ÅŸlem Tipi</label>
        {{ finans_form.islem_tipi }}
    </div>
    
    <div class="row g-2">
        <div class="col-6">
            <label class="form-label small fw-bold">Tutar (TL)</label>
            {{ finans_form.tutar }}
        </div>
        <div class="col-6">
            <label class="form-label small fw-bold">AÃ§Ä±klama</label>
            {{ finans_form.aciklama }}
        </div>
    </div>

    <div class="d-none">
        {{ finans_form.personel }}
    </div>

    <button type="submit" class="btn btn-dark w-100 mt-3">Kaydet</button>
</form>

<h5 class="ms-1">Son Finansal Hareketler</h5>
<ul class="list-group shadow-sm">
    {% for h in hareketler %}
    <li class="list-group-item d-flex justify-content-between align-items-center">
        <div>
            <span class="fw-bold 
                {% if h.islem_tipi == 'prim' %} text-primary 
                {% else %} text-dark {% endif %}">
                {{ h.get_islem_tipi_display }}
            </span>
            <br>
            <small class="text-muted" style="font-size: 0.8rem;">
                {{ h.tarih|date:"d M Y" }} 
                {% if h.aciklama %} - {{ h.aciklama }}{% endif %}
            </small>
        </div>

        {% if h.islem_tipi == 'prim' %}
            <span class="fw-bold text-success fs-5">+{{ h.tutar }} TL</span>
        {% else %}
            <span class="fw-bold text-danger fs-5">-{{ h.tutar }} TL</span>
        {% endif %}
    </li>
    {% empty %}
    <li class="list-group-item text-center text-muted py-3">HenÃ¼z bir hareket yok.</li>
    {% endfor %}
</ul>

{% if avanslar %}
<h5 class="mt-4 ms-1">Taksitli BorÃ§lar</h5>
<ul class="list-group shadow-sm mb-5">
    {% for a in avanslar %}
    <li class="list-group-item d-flex justify-content-between align-items-center">
        <div>
            <span>Taksitli Avans ({{ a.taksit_sayisi }} Taksit)</span>
            <br>
            <small class="text-muted">AylÄ±k Kesinti: {{ a.aylik_kesinti|stringformat:".2f" }} TL</small>
        </div>
        
        {% if a.tamamlandi %}
            <span class="badge bg-success">Ã–dendi</span>
        {% else %}
            <span class="badge bg-warning text-dark">Devam Ediyor</span>
        {% endif %}
    </li>
    {% endfor %}
</ul>
{% endif %}

<div style="height: 50px;"></div>
{% endblock %}